# 实现12356功能并优化代码结构

## 一、功能实现计划

### 1. 数据流转机制
- **增强SharedDataService**：完善数据共享和消息广播机制
- **实现PdfPreviewPanel自动响应数据变更**：监听数据变更消息并自动更新PDF预览
- **完善数据绑定**：确保各ViewModel与View之间的绑定关系清晰
- **增强消息处理逻辑**：添加错误处理和数据验证

### 2. PDF生成和预览
- **完善PdfService**：实现完整的PDF生成、预览、导出和打印功能
- **增强PdfPreviewViewModel**：实现PDF预览的自动更新和错误处理
- **优化WebView2初始化逻辑**：添加错误处理和状态管理

### 3. 模板管理
- **完善TemplateService**：实现完整的模板管理功能
- **增强TemplateTreeViewModel**：实现模板的分类、搜索和管理
- **优化模板数据结构**：完善TemplateData类的属性和方法

### 5. UI交互
- **优化各View的布局和交互**：提升用户体验
- **实现响应式设计**：添加窗口大小变化时的布局调整
- **增强用户操作反馈**：添加操作成功和失败的反馈机制

### 6. 代码结构
- **实现依赖注入**：配置依赖注入容器并使用构造函数注入
- **完善MVVM模式实现**：确保ViewModel和View的绑定关系清晰
- **优化代码组织**：调整代码文件的组织和命名

## 二、文件修改和新增计划

### 1. 服务层
- **修改Services/Shared/SharedDataService.cs**：增强数据共享和消息广播机制
- **修改Services/Pdf/PdfService.cs**：完善PDF生成和预览功能
- **修改Services/Data/TemplateService.cs**：增强模板管理功能
- **新增Services/DI/ServiceLocator.cs**：实现依赖注入容器

### 2. ViewModel层
- **修改ViewModels/DataEntryViewModel.cs**：增强数据验证和错误处理
- **修改ViewModels/PdfPreviewViewModel.cs**：实现PDF预览的自动更新
- **修改ViewModels/TemplateEditorViewModel.cs**：完善模板编辑功能
- **修改ViewModels/TemplateTreeViewModel.cs**：增强模板管理功能
- **修改ViewModels/MainViewModel.cs**：实现依赖注入和命令绑定

### 3. View层
- **修改Views/Panels/DataEntryPanel.xaml**：优化布局和交互
- **修改Views/Panels/PdfPreviewPanel.xaml**：增强PDF预览功能
- **修改Views/Panels/TemplateEditorPanel.xaml**：完善模板编辑界面
- **修改Views/Panels/TemplateTreePanel.xaml**：优化模板树交互
- **修改MainWindow.xaml**：实现响应式设计

### 4. 模型层
- **修改Models/CoreEntities/TemplateData.cs**：完善模板数据结构
- **修改Models/CoreEntities/ControlElement.cs**：增强控件元素功能

## 三、实现步骤

1. **实现依赖注入**：配置依赖注入容器并修改各ViewModel的构造函数
2. **增强数据流转机制**：完善SharedDataService和消息处理逻辑
3. **实现PDF生成和预览功能**：完善PdfService和PdfPreviewViewModel
4. **增强模板管理功能**：完善TemplateService和TemplateTreeViewModel
5. **优化UI交互**：调整各View的布局和交互逻辑
6. **测试和调试**：确保所有功能正常运行

## 四、预期成果

- 实现完整的数据流转机制，确保各面板之间的数据同步
- 实现完整的PDF生成和预览功能
- 实现完整的模板管理功能
- 优化UI交互，提升用户体验
- 完善代码结构，使用依赖注入和MVVM模式
- 将功能拆分到各自的view和更细致的viewmodel中，提高代码可维护性