<Window x:Class="ReportTemplateEditor.App.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:hc="https://handyorg.github.io/handycontrol"
        xmlns:vm="clr-namespace:ReportTemplateEditor.App.ViewModels"
        xmlns:views="clr-namespace:ReportTemplateEditor.App.Views"
        xmlns:helpers="clr-namespace:ReportTemplateEditor.App.Helpers"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}"
        Height="800"
        Width="1400"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Menu Grid.Row="0" Background="{DynamicResource RegionBrush}">
            <MenuItem Header="文件">
                <MenuItem Header="打开其他目录" Command="{Binding OpenOtherDirectoryCommand}"/>
                <MenuItem Header="打开内置模板目录" Command="{Binding OpenBuiltInTemplatesCommand}"/>
                <Separator/>
                <MenuItem Header="打开模板设计器" Command="{Binding OpenDesignerCommand}"/>
                <Separator/>
                <MenuItem Header="保存模板" Command="{Binding SaveTemplateCommand}"/>
                <Separator/>
                <MenuItem Header="退出" Command="{Binding ExitCommand}"/>
            </MenuItem>
            <MenuItem Header="编辑">
                <MenuItem Header="刷新模板" Command="{Binding TemplateTreeViewModel.RefreshCommand}"/>
                <MenuItem Header="刷新控件" Command="{Binding ControlPanelViewModel.RefreshControlsCommand}"/>
                <MenuItem Header="刷新预览" Command="{Binding PdfPreviewViewModel.RefreshPreviewCommand}"/>
            </MenuItem>
            <MenuItem Header="打印">
                <MenuItem Header="打印" Command="{Binding PdfPreviewViewModel.PrintCommand}"/>
                <MenuItem Header="保存为PDF" Command="{Binding PdfPreviewViewModel.SavePdfCommand}"/>
            </MenuItem>
        </Menu>

        <Grid Grid.Row="1" Margin="5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="{DynamicResource BorderBrush}"/>
            <GridSplitter Grid.Column="3" Width="5" HorizontalAlignment="Stretch" Background="{DynamicResource BorderBrush}"/>

            <Border Grid.Column="0" Background="{DynamicResource SecondaryRegionBrush}" CornerRadius="4">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="{DynamicResource PrimaryBrush}" Padding="15,10" CornerRadius="4,4,0,0">
                        <TextBlock Text="模板树" Foreground="White" FontSize="16" FontWeight="Bold"/>
                    </Border>

                    <Border Grid.Row="1" Padding="10" Background="{DynamicResource RegionBrush}">
                        <StackPanel>
                            <Button Content="选择模板目录" Command="{Binding SelectTemplateDirectoryCommand}" 
                                    Style="{StaticResource ButtonPrimary}" Margin="0,0,0,5"/>
                            <Button Content="刷新" Command="{Binding TemplateTreeViewModel.RefreshCommand}" 
                                    Style="{StaticResource ButtonDefault}"/>
                        </StackPanel>
                    </Border>

                    <TreeView Grid.Row="2" ItemsSource="{Binding TemplateTreeViewModel.TreeItems}"
                              helpers:TreeViewHelper.SelectedItem="{Binding TemplateTreeViewModel.SelectedItem, Mode=TwoWay}"
                              SelectedItemChanged="TreeView_SelectedItemChanged"
                              Margin="5">
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Name}" Margin="5,0"/>
                                </StackPanel>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>
                    </TreeView>

                    <Border Grid.Row="3" Padding="10" Background="{DynamicResource RegionBrush}" CornerRadius="0,0,4,4">
                        <TextBlock Text="{Binding TemplateTreeViewModel.StatusMessage}" Foreground="{DynamicResource PrimaryTextBrush}" TextWrapping="Wrap"/>
                    </Border>
                </Grid>
            </Border>

            <Border Grid.Column="2" Background="{DynamicResource SecondaryRegionBrush}" CornerRadius="4">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="{DynamicResource PrimaryBrush}" Padding="15,10" CornerRadius="4,4,0,0">
                        <TextBlock Text="控件面板" Foreground="White" FontSize="16" FontWeight="Bold"/>
                    </Border>

                    <Border Grid.Row="1" Background="White" Margin="5" CornerRadius="4" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1">
                        <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
                            <WrapPanel x:Name="ControlPanel" Margin="10" Background="White" Orientation="Horizontal" ItemWidth="Auto" ItemHeight="Auto">
                            </WrapPanel>
                        </ScrollViewer>
                    </Border>

                    <Border Grid.Row="2" Padding="10" Background="{DynamicResource RegionBrush}" CornerRadius="0,0,4,4">
                        <TextBlock Text="{Binding ControlPanelViewModel.StatusMessage}" Foreground="{DynamicResource PrimaryTextBrush}" TextWrapping="Wrap"/>
                    </Border>
                </Grid>
            </Border>

            <Border Grid.Column="4" Background="{DynamicResource SecondaryRegionBrush}" CornerRadius="4">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="{DynamicResource PrimaryBrush}" Padding="15,10" CornerRadius="4,4,0,0">
                        <TextBlock Text="PDF预览" Foreground="White" FontSize="16" FontWeight="Bold"/>
                    </Border>

                    <Border Grid.Row="1" Padding="10" Background="{DynamicResource RegionBrush}">
                        <StackPanel Orientation="Horizontal">
                            <Button Content="打印" Command="{Binding PdfPreviewViewModel.PrintCommand}" 
                                    Style="{StaticResource ButtonPrimary}" Margin="0,0,5,0" Width="80"/>
                            <Button Content="保存PDF" Command="{Binding PdfPreviewViewModel.SavePdfCommand}" 
                                    Style="{StaticResource ButtonDefault}" Margin="0,0,5,0" Width="80"/>
                            <Button Content="刷新" Command="{Binding PdfPreviewViewModel.RefreshPreviewCommand}" 
                                    Style="{StaticResource ButtonDefault}" Margin="0,0,5,0" Width="60"/>
                            <Button Content="放大" Command="{Binding PdfPreviewViewModel.ZoomInCommand}" 
                                    Style="{StaticResource ButtonDefault}" Margin="0,0,5,0" Width="60"/>
                            <Button Content="缩小" Command="{Binding PdfPreviewViewModel.ZoomOutCommand}" 
                                    Style="{StaticResource ButtonDefault}" Margin="0,0,5,0" Width="60"/>
                            <Button Content="重置" Command="{Binding PdfPreviewViewModel.ResetZoomCommand}" 
                                    Style="{StaticResource ButtonDefault}" Width="60"/>
                        </StackPanel>
                    </Border>

                    <Border Grid.Row="2" Background="White" Margin="5" CornerRadius="4" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1">
                        <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                            <Image Source="{Binding PdfPreviewViewModel.PreviewImage}" 
                                   Stretch="Uniform" 
                                   RenderTransformOrigin="0.5,0.5">
                                <Image.RenderTransform>
                                    <ScaleTransform ScaleX="{Binding PdfPreviewViewModel.ZoomLevel}" 
                                                ScaleY="{Binding PdfPreviewViewModel.ZoomLevel}"/>
                                </Image.RenderTransform>
                            </Image>
                        </ScrollViewer>
                    </Border>

                    <Border Grid.Row="3" Padding="10" Background="{DynamicResource RegionBrush}" CornerRadius="0,0,4,4">
                        <StackPanel>
                            <TextBlock Text="{Binding PdfPreviewViewModel.StatusMessage}" Foreground="{DynamicResource PrimaryTextBrush}" TextWrapping="Wrap"/>
                            <TextBlock Text="{Binding PdfPreviewViewModel.ZoomLevel, StringFormat='缩放: {0:P0}'}" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <StatusBar Grid.Row="2" Background="{DynamicResource RegionBrush}">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="就绪" Margin="10,0"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
