# 报告归档与微信查询流程

## 流程一：WPF 打印前归档
1. 医生在 WPF 中完成报告填写。
2. 点击“打印”时，系统先将完整报告（含所有字段值、模板ID、操作人）发送到内网服务端。
3. 内网服务生成唯一报告编号（如 LAB20260110-00123），存入数据库，并返回成功。
4. WPF 收到成功响应后才执行本地打印，并在纸质报告上显示该编号。
5. 若归档失败（如网络中断），则禁止打印并提示错误。

## 流程二：患者微信查询
1. 患者进入医院公众号，点击“报告查询”。
2. 小程序引导用户授权微信身份，并输入报告编号（或身份证+姓名）。
3. 请求发送至外网服务，外网服务验证身份后，向内网服务发起安全查询。
4. 内网服务返回脱敏后的报告数据（隐藏内部审核人等敏感信息）。
5. 外网服务将数据渲染为 HTML 页面，小程序展示给患者。

## 安全要求
- 内网服务不暴露公网，仅允许外网服务通过认证通道调用。
- 所有查询记录日志，包含时间、用户标识、报告编号。
- 敏感操作（如首次查询）可增加短信验证。
