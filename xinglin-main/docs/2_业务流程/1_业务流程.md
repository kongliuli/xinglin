# C_业务流程

## C.1 报告归档流程

### C.1.1 WPF 打印前归档
C.1.1.1 报告填写：医生在 WPF 中完成报告填写。
C.1.1.2 归档请求：点击"打印"时，系统先将完整报告（含所有字段值、模板ID、操作人）发送到内网服务端。
C.1.1.3 编号生成：内网服务生成唯一报告编号（如 LAB20260110-00123），存入数据库，并返回成功。
C.1.1.4 执行打印：WPF 收到成功响应后才执行本地打印，并在纸质报告上显示该编号。
C.1.1.5 错误处理：若归档失败（如网络中断），则禁止打印并提示错误。

## C.2 微信查询流程

### C.2.1 患者查询
C.2.1.1 进入入口：患者进入医院公众号，点击"报告查询"。
C.2.1.2 身份验证：小程序引导用户授权微信身份，并输入报告编号（或身份证+姓名）。
C.2.1.3 请求转发：请求发送至外网服务，外网服务验证身份后，向内网服务发起安全查询。
C.2.1.4 数据返回：内网服务返回脱敏后的报告数据（隐藏内部审核人等敏感信息）。
C.2.1.5 页面展示：外网服务将数据渲染为 HTML 页面，小程序展示给患者。

## C.3 安全要求

### C.3.1 网络安全
C.3.1.1 服务隔离：内网服务不暴露公网，仅允许外网服务通过认证通道调用。
C.3.1.2 访问控制：所有查询记录日志，包含时间、用户标识、报告编号。
C.3.1.3 身份验证：敏感操作（如首次查询）可增加短信验证。

### C.3.2 数据安全
C.3.2.1 数据脱敏：患者查询时返回脱敏数据，隐藏敏感信息。
C.3.2.2 权限控制：不同角色（医生、患者、管理员）只能访问对应权限的数据。
C.3.2.3 审计日志：所有数据操作均记录详细日志，便于追溯。