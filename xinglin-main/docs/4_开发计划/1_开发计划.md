# E_开发计划

## E.1 开发阶段

### E.1.1 第一阶段：基础类库（1–2 周）
E.1.1.1 通用模型与接口库：定义病人、报告、模板等核心业务实体及其接口。
E.1.1.2 数据访问与文件工具库：开发用于数据库操作和本地文件读写的通用工具。

### E.1.2 第二阶段：WPF 客户端核心功能（2–3 周）
E.1.2.1 报告录入界面：基于WPF技术栈，设计并实现用户友好的报告录入界面。
E.1.2.2 打印引擎：开发高性能的打印引擎，确保报告内容能够精准地在A4纸上呈现。
E.1.2.3 预览功能：提供打印前的实时预览功能，确保报告格式正确。

### E.1.3 第三阶段：数据源适配器（1–2 周）
E.1.3.1 插件化框架：设计并实现一个可动态加载不同数据源模块的插件化框架。
E.1.3.2 HIS适配器：开发HIS数据库查询适配器，支持从医院信息系统获取患者信息。
E.1.3.3 读卡器适配器：开发身份证读卡器适配器，支持读取身份证信息。
E.1.3.4 API适配器：开发通用第三方API适配器，支持从外部系统获取数据。

### E.1.4 第四阶段：服务端开发（2 周）
E.1.4.1 内网服务端：
  - 报告归档接口：接收并存储客户端提交的报告数据。
  - 安全查询接口：为外网服务提供安全的数据查询通道。
  - 数据管理：实现报告数据的存储、检索和管理功能。

E.1.4.2 外网服务端：
  - 微信对接：实现与微信公众号/小程序的对接。
  - 身份验证：处理患者身份验证和授权。
  - 报告渲染：将内网返回的数据渲染为HTML页面。

### E.1.5 第五阶段：授权与管控（1 周）
E.1.5.1 主控服务端：
  - 机器码管理：实现机器码注册、验证和管理功能。
  - 激活码验证：验证用户输入的激活码有效性。
  - 授权管理：管理医院的授权状态和有效期。
  - 心跳校验：处理客户端心跳请求，检查授权状态。
  - 模板下发：管理和分发报告模板。
  - 权限控制：管理医院的功能权限。

## E.2 项目结构

### E.2.1 核心项目
E.2.1.1 Core（通用模型）：包含所有核心业务实体和接口定义。
E.2.1.2 Infrastructure（数据/文件工具）：包含数据访问和文件操作工具。
E.2.1.3 Client.WPF（主程序）：WPF客户端应用程序。
E.2.1.4 Printing.Service（打印引擎）：报告打印服务。
E.2.1.5 DataAdapters（适配器框架）：数据源适配器框架和实现。
E.2.1.6 Server.API（服务端）：包含内网服务、外网服务和主控服务。

### E.2.2 项目依赖
E.2.2.1 前端依赖：WPF框架、MVVM框架、打印组件。
E.2.2.2 后端依赖：ASP.NET Core、数据库ORM、身份验证组件。
E.2.2.3 通用依赖：日志组件、配置管理、网络通信组件。

## E.3 技术栈

### E.3.1 客户端技术
E.3.1.1 框架：WPF
E.3.1.2 语言：C#
E.3.1.3 数据访问：SqlSugar（ORM）

### E.3.2 服务端技术
E.3.2.1 框架：ASP.NET Core
E.3.2.2 语言：C#
E.3.2.3 数据库：SQL Server
E.3.2.4 缓存：Redis

### E.3.3 部署方案
E.3.3.1 客户端：Windows安装包
E.3.3.2 内网服务：Windows Server/IIS
E.3.3.3 外网服务：云服务器/Docker
E.3.3.4 主控服务：云服务器/Docker