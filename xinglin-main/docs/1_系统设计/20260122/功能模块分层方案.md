# 功能模块分层方案

## 一、分层架构概述

杏林病理检验报告系统采用经典的分层架构设计，将系统划分为五个主要层次，每层职责明确，依赖关系清晰，确保系统的高内聚低耦合。

### 1.1 分层结构

```
┌─────────────────────────────────────────────────────────────┐
│                  表现层 (Presentation Layer)              │
│  Xinglin.Client.WPF + Xinglin.Client.Core          │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│                   应用层 (Application Layer)            │
│  业务逻辑、服务接口、ViewModel                         │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│                   领域层 (Domain Layer)               │
│  Xinglin.Core (模型、接口)                           │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│                基础设施层 (Infrastructure Layer)        │
│  Xinglin.Infrastructure + Xinglin.DataAdapters       │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│                  横切关注点 (Cross-Cutting)          │
│  Xinglin.Common + Xinglin.Security                  │
└─────────────────────────────────────────────────────────────┘
```

## 二、各层详细设计

### 2.1 表现层 (Presentation Layer)

#### 2.1.1 层级定位
- **位置**: 系统最上层，直接与用户交互
- **职责**: 提供用户界面，处理用户输入，展示数据
- **包含项目**:
  - Xinglin.Client.WPF
  - Xinglin.Client.Core

#### 2.1.2 核心功能模块

##### 报告录入模块
- **归属项目**: Xinglin.Client.WPF / Xinglin.Client.Core
- **功能描述**: 提供报告录入界面，支持动态模板加载
- **主要组件**:
  - ReportEntryView.xaml (报告录入视图)
  - ReportEntryViewModel (报告录入视图模型)
  - TemplateSelectorView (模板选择器)
  - DataAdapterSelectorView (数据源选择器)

##### 报告预览模块
- **归属项目**: Xinglin.Client.WPF / Xinglin.Client.Core
- **功能描述**: 提供报告打印前的实时预览
- **主要组件**:
  - ReportPreviewView.xaml (报告预览视图)
  - ReportPreviewViewModel (报告预览视图模型)
  - PreviewRenderer (预览渲染器)

##### 打印管理模块
- **归属项目**: Xinglin.Client.WPF / Xinglin.Printing.Service
- **功能描述**: 管理打印任务，实现A4纸精准打印
- **主要组件**:
  - PrintManager (打印管理器)
  - PrintQueue (打印队列)
  - PrintSettings (打印设置)

##### 设置管理模块
- **归属项目**: Xinglin.Client.WPF / Xinglin.Client.Core
- **功能描述**: 提供系统设置界面
- **主要组件**:
  - SettingsView.xaml (设置视图)
  - SettingsViewModel (设置视图模型)
  - AdapterConfigView (适配器配置视图)

##### 数据源管理模块
- **归属项目**: Xinglin.Client.WPF / Xinglin.Client.Core
- **功能描述**: 管理数据源适配器，测试连接
- **主要组件**:
  - DataAdapterManager (适配器管理器)
  - ConnectionTester (连接测试器)
  - AdapterConfigEditor (适配器配置编辑器)

#### 2.1.3 MVVM架构实现

##### ViewModel基类
- **归属项目**: Xinglin.Client.Core
- **职责**: 提供ViewModel基础功能
- **主要接口**:
  - INotifyPropertyChanged实现
  - 命令处理
  - 数据验证
  - 消息传递

##### 命令系统
- **归属项目**: Xinglin.Client.Core
- **职责**: 提供命令处理机制
- **主要类型**:
  - RelayCommand
  - AsyncRelayCommand
  - ParameterCommand

##### 消息系统
- **归属项目**: Xinglin.Client.Core
- **职责**: 实现ViewModel间通信
- **主要接口**:
  - IMessenger
  - MessageBase
  - 订阅/发布机制

### 2.2 应用层 (Application Layer)

#### 2.2.1 层级定位
- **位置**: 表现层与领域层之间
- **职责**: 编排业务逻辑，协调领域对象
- **包含项目**:
  - Xinglin.Client.Core (客户端应用逻辑)
  - Xinglin.Server.Internal.Core (内网服务应用逻辑)
  - Xinglin.Server.External.Core (外网服务应用逻辑)
  - Xinglin.Server.Master.Core (主控服务应用逻辑)

#### 2.2.2 桌面端应用层模块

##### 报告服务
- **归属项目**: Xinglin.Client.Core
- **功能描述**: 处理报告相关业务逻辑
- **主要接口**:
  - IReportService
  - 方法: CreateReport, UpdateReport, DeleteReport, GetReport

##### 病人信息服务
- **归属项目**: Xinglin.Client.Core
- **功能描述**: 处理病人信息相关业务逻辑
- **主要接口**:
  - IPatientService
  - 方法: GetPatient, SearchPatient, SavePatient

##### 模板服务
- **归属项目**: Xinglin.Client.Core
- **功能描述**: 处理模板相关业务逻辑
- **主要接口**:
  - ITemplateService
  - 方法: GetTemplate, LoadTemplate, ValidateTemplate

##### 授权服务
- **归属项目**: Xinglin.Client.Core
- **功能描述**: 处理授权相关业务逻辑
- **主要接口**:
  - IAuthorizationService
  - 方法: Activate, Validate, GetPermissions

#### 2.2.3 内网服务应用层模块

##### 报告归档服务
- **归属项目**: Xinglin.Server.Internal.Core
- **功能描述**: 处理报告归档业务逻辑
- **主要接口**:
  - IReportArchiveService
  - 方法: ArchiveReport, GetArchivedReport, GenerateReportNumber

##### 报告查询服务
- **归属项目**: Xinglin.Server.Internal.Core
- **功能描述**: 处理报告查询业务逻辑
- **主要接口**:
  - IReportQueryService
  - 方法: QueryByNumber, QueryByPatient, QueryByDateRange

##### 审计日志服务
- **归属项目**: Xinglin.Server.Internal.Core
- **功能描述**: 处理审计日志业务逻辑
- **主要接口**:
  - IAuditLogService
  - 方法: LogQuery, LogAccess, LogOperation

#### 2.2.4 外网服务应用层模块

##### 微信认证服务
- **归属项目**: Xinglin.Server.External.Core
- **功能描述**: 处理微信OAuth认证
- **主要接口**:
  - IWeChatAuthService
  - 方法: Authenticate, GetUserInfo, RefreshToken

##### 报告查询转发服务
- **归属项目**: Xinglin.Server.External.Core
- **功能描述**: 转发报告查询请求到内网服务
- **主要接口**:
  - IReportForwardService
  - 方法: ForwardQuery, GetReportFromInternal

##### 数据脱敏服务
- **归属项目**: Xinglin.Server.External.Core
- **功能描述**: 对敏感数据进行脱敏处理
- **主要接口**:
  - IDataMaskingService
  - 方法: MaskPatientInfo, MaskDoctorInfo, MaskInternalFields

##### HTML报告生成服务
- **归属项目**: Xinglin.Server.External.Core
- **功能描述**: 生成HTML格式的报告
- **主要接口**:
  - IHtmlReportService
  - 方法: GenerateHtml, ApplyStyles, RenderTemplate

#### 2.2.5 主控服务应用层模块

##### 授权管理服务
- **归属项目**: Xinglin.Server.Master.Core
- **功能描述**: 管理医院授权信息
- **主要接口**:
  - ILicenseManagementService
  - 方法: CreateLicense, UpdateLicense, RevokeLicense, ValidateLicense

##### 模板管理服务
- **归属项目**: Xinglin.Server.Master.Core
- **功能描述**: 管理报告模板版本
- **主要接口**:
  - ITemplateManagementService
  - 方法: CreateTemplate, UpdateTemplate, PublishTemplate, AssignTemplate

##### 心跳校验服务
- **归属项目**: Xinglin.Server.Master.Core
- **功能描述**: 处理客户端心跳校验
- **主要接口**:
  - IHeartbeatService
  - 方法: ReceiveHeartbeat, CheckExpiration, UpdateStatus

##### 权限分发服务
- **归属项目**: Xinglin.Server.Master.Core
- **功能描述**: 分发功能权限配置
- **主要接口**:
  - IPermissionDistributionService
  - 方法: GetPermissions, UpdatePermissions, ValidatePermission

### 2.3 领域层 (Domain Layer)

#### 2.3.1 层级定位
- **位置**: 应用层与基础设施层之间
- **职责**: 定义核心业务模型和业务规则
- **包含项目**:
  - Xinglin.Core

#### 2.3.2 核心领域模型

##### 病人信息模型
- **归属项目**: Xinglin.Core
- **职责**: 定义病人信息数据结构
- **主要属性**:
  - PatientId (病人ID)
  - Name (姓名)
  - Gender (性别)
  - Age (年龄)
  - IdCard (身份证号)
  - Phone (联系电话)

##### 报告模型
- **归属项目**: Xinglin.Core
- **职责**: 定义报告数据结构
- **主要属性**:
  - ReportId (报告ID)
  - ReportNumber (报告编号)
  - PatientId (病人ID)
  - TemplateId (模板ID)
  - Content (报告内容)
  - Status (状态)
  - CreatedAt (创建时间)
  - CreatedBy (创建人)

##### 模板模型
- **归属项目**: Xinglin.Core
- **职责**: 定义模板数据结构
- **主要属性**:
  - TemplateId (模板ID)
  - Name (模板名称)
  - Version (版本号)
  - Content (模板内容JSON)
  - IsPublished (是否发布)
  - CreatedAt (创建时间)

##### 授权模型
- **归属项目**: Xinglin.Core
- **职责**: 定义授权数据结构
- **主要属性**:
  - LicenseId (授权ID)
  - HospitalId (医院ID)
  - MachineCode (机器码)
  - ActivationCode (激活码)
  - ExpirationDate (过期日期)
  - Permissions (权限JSON)
  - Status (状态)

##### 用户模型
- **归属项目**: Xinglin.Core
- **职责**: 定义用户数据结构
- **主要属性**:
  - UserId (用户ID)
  - Username (用户名)
  - Role (角色)
  - HospitalId (医院ID)
  - IsActive (是否激活)

#### 2.3.3 领域接口

##### 数据源适配器接口
- **归属项目**: Xinglin.Core
- **职责**: 定义数据源适配器统一接口
- **主要方法**:
  - GetPatientInfo(string identifier)
  - TestConnection()
  - GetAdapterInfo()

##### 报告仓储接口
- **归属项目**: Xinglin.Core
- **职责**: 定义报告数据访问接口
- **主要方法**:
  - AddAsync(Report report)
  - UpdateAsync(Report report)
  - GetByIdAsync(Guid id)
  - QueryAsync(ReportQuery query)

##### 模板仓储接口
- **归属项目**: Xinglin.Core
- **职责**: 定义模板数据访问接口
- **主要方法**:
  - AddAsync(Template template)
  - UpdateAsync(Template template)
  - GetByIdAsync(Guid id)
  - GetByVersionAsync(string version)

### 2.4 基础设施层 (Infrastructure Layer)

#### 2.4.1 层级定位
- **位置**: 领域层之下，提供技术实现
- **职责**: 提供数据访问、文件操作等技术支持
- **包含项目**:
  - Xinglin.Infrastructure
  - Xinglin.DataAdapters

#### 2.4.2 数据访问模块

##### 数据库上下文
- **归属项目**: Xinglin.Infrastructure
- **功能描述**: 封装数据库连接和配置
- **主要组件**:
  - XinglinDbContext (数据库上下文)
  - ConnectionStringProvider (连接字符串提供者)
  - DbConfig (数据库配置)

##### 报告仓储实现
- **归属项目**: Xinglin.Infrastructure
- **功能描述**: 实现报告数据访问
- **主要组件**:
  - ReportRepository (报告仓储)
  - 使用SqlSugar ORM
  - 实现IReportRepository接口

##### 模板仓储实现
- **归属项目**: Xinglin.Infrastructure
- **功能描述**: 实现模板数据访问
- **主要组件**:
  - TemplateRepository (模板仓储)
  - 使用SqlSugar ORM
  - 实现ITemplateRepository接口

##### 授权仓储实现
- **归属项目**: Xinglin.Infrastructure
- **功能描述**: 实现授权数据访问
- **主要组件**:
  - LicenseRepository (授权仓储)
  - 使用SqlSugar ORM
  - 实现ILicenseRepository接口

#### 2.4.3 文件操作模块

##### 文件管理器
- **归属项目**: Xinglin.Infrastructure
- **功能描述**: 提供文件读写操作
- **主要组件**:
  - IFileManager (文件管理器接口)
  - LocalFileManager (本地文件管理器)
  - 方法: ReadFile, WriteFile, DeleteFile, Exists

##### 配置管理器
- **归属项目**: Xinglin.Infrastructure
- **功能描述**: 提供配置文件读写
- **主要组件**:
  - IConfigurationManager (配置管理器接口)
  - JsonConfigurationManager (JSON配置管理器)
  - 方法: Load, Save, GetSection, UpdateSection

##### 日志记录器
- **归属项目**: Xinglin.Infrastructure
- **功能描述**: 提供日志记录功能
- **主要组件**:
  - ILogger (日志记录器接口)
  - SerilogLogger (Serilog实现)
  - 方法: LogDebug, LogInfo, LogWarning, LogError

#### 2.4.4 数据源适配器模块

##### 适配器框架
- **归属项目**: Xinglin.DataAdapters
- **功能描述**: 提供适配器插件化框架
- **主要组件**:
  - IDataAdapter (适配器接口)
  - AdapterManager (适配器管理器)
  - AdapterLoader (适配器加载器)
  - AdapterConfig (适配器配置)

##### HIS数据库适配器
- **归属项目**: Xinglin.DataAdapters
- **功能描述**: 实现HIS数据库数据源适配
- **主要组件**:
  - HisDatabaseAdapter (HIS数据库适配器)
  - 实现IDataAdapter接口
  - 支持多种数据库类型

##### 身份证读卡器适配器
- **归属项目**: Xinglin.DataAdapters
- **功能描述**: 实现身份证读卡器数据源适配
- **主要组件**:
  - IdCardReaderAdapter (身份证读卡器适配器)
  - 实现IDataAdapter接口
  - 支持多种读卡器型号

##### 第三方API适配器
- **归属项目**: Xinglin.DataAdapters
- **功能描述**: 实现第三方API数据源适配
- **主要组件**:
  - ThirdPartyApiAdapter (第三方API适配器)
  - 实现IDataAdapter接口
  - 支持HTTP/HTTPS协议

### 2.5 横切关注点 (Cross-Cutting Concerns)

#### 2.5.1 层级定位
- **位置**: 横跨所有层次
- **职责**: 提供通用功能和工具
- **包含项目**:
  - Xinglin.Common
  - Xinglin.Security

#### 2.5.2 通用工具模块

##### 字符串扩展
- **归属项目**: Xinglin.Common
- **功能描述**: 提供字符串操作扩展方法
- **主要方法**:
  - ToSafeString()
  - ToMaskedString()
  - ContainsChinese()
  - FormatPhoneNumber()

##### 日期时间工具
- **归属项目**: Xinglin.Common
- **功能描述**: 提供日期时间处理工具
- **主要方法**:
  - ToChineseDateString()
  - GetAge()
  - IsWeekend()
  - FormatDateTime()

##### JSON序列化工具
- **归属项目**: Xinglin.Common
- **功能描述**: 提供JSON序列化/反序列化工具
- **主要方法**:
  - SerializeToJson()
  - DeserializeFromJson()
  - PrettyPrintJson()

##### 验证工具
- **归属项目**: Xinglin.Common
- **功能描述**: 提供数据验证工具
- **主要方法**:
  - ValidateIdCard()
  - ValidatePhoneNumber()
  - ValidateEmail()
  - ValidateReportNumber()

##### 异常处理
- **归属项目**: Xinglin.Common
- **功能描述**: 提供统一的异常处理机制
- **主要组件**:
  - XinglinException (基础异常类)
  - BusinessException (业务异常)
  - ValidationException (验证异常)
  - ExceptionHandler (异常处理器)

#### 2.5.3 安全模块

##### 加密解密工具
- **归属项目**: Xinglin.Security
- **功能描述**: 提供数据加密解密功能
- **主要方法**:
  - EncryptString()
  - DecryptString()
  - EncryptBytes()
  - DecryptBytes()

##### 哈希计算工具
- **归属项目**: Xinglin.Security
- **功能描述**: 提供哈希计算功能
- **主要方法**:
  - ComputeSha256()
  - ComputeMd5()
  - ComputeHmac()

##### 机器码生成工具
- **归属项目**: Xinglin.Security
- **功能描述**: 生成和验证机器码
- **主要方法**:
  - GenerateMachineCode()
  - ValidateMachineCode()
  - GetHardwareInfo()

##### 签名验证工具
- **归属项目**: Xinglin.Security
- **功能描述**: 提供数字签名功能
- **主要方法**:
  - SignData()
  - VerifySignature()
  - GenerateKeyPair()

##### 权限验证工具
- **归属项目**: Xinglin.Security
- **功能描述**: 提供权限验证功能
- **主要方法**:
  - HasPermission()
  - RequirePermission()
  - GetPermissions()

## 三、服务端分层设计

### 3.1 内网服务端分层

```
┌─────────────────────────────────────────────┐
│  Xinglin.Server.Internal (Web API)       │
│  - Controllers (API控制器)               │
│  - Middleware (中间件)                   │
│  - Startup (启动配置)                    │
└─────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────┐
│  Xinglin.Server.Internal.Core (应用层)   │
│  - Services (业务服务)                   │
│  - Validators (数据验证)                  │
│  - BusinessRules (业务规则)               │
└─────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────┐
│  Xinglin.Server.Internal.API (API层)     │
│  - DTOs (数据传输对象)                  │
│  - Mappers (对象映射)                   │
│  - ApiModels (API模型)                  │
└─────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────┐
│  Xinglin.Core (领域层)                 │
│  - Models (领域模型)                    │
│  - Interfaces (接口定义)                 │
└─────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────┐
│  Xinglin.Infrastructure (基础设施层)      │
│  - Repositories (数据仓储)               │
│  - DbContext (数据库上下文)              │
└─────────────────────────────────────────────┘
```

### 3.2 外网服务端分层

```
┌─────────────────────────────────────────────┐
│  Xinglin.Server.External (Web API)      │
│  - Controllers (API控制器)               │
│  - WeChatMiddleware (微信中间件)         │
│  - Startup (启动配置)                    │
└─────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────┐
│  Xinglin.Server.External.Core (应用层)  │
│  - WeChatServices (微信服务)           │
│  - DataMaskingServices (数据脱敏)       │
│  - HtmlReportServices (HTML报告)         │
└─────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────┐
│  Xinglin.Server.External.API (API层)    │
│  - DTOs (数据传输对象)                  │
│  - Mappers (对象映射)                   │
│  - ApiModels (API模型)                  │
└─────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────┐
│  Xinglin.Core (领域层)                 │
│  - Models (领域模型)                    │
│  - Interfaces (接口定义)                 │
└─────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────┐
│  Xinglin.Infrastructure (基础设施层)      │
│  - Repositories (数据仓储)               │
│  - HttpClient (HTTP客户端)              │
└─────────────────────────────────────────────┘
```

### 3.3 主控服务端分层

```
┌─────────────────────────────────────────────┐
│  Xinglin.Server.Master (Web API)       │
│  - Controllers (API控制器)               │
│  - AdminMiddleware (管理中间件)           │
│  - Startup (启动配置)                    │
└─────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────┐
│  Xinglin.Server.Master.Core (应用层)     │
│  - LicenseServices (授权服务)            │
│  - TemplateServices (模板服务)           │
│  - HeartbeatServices (心跳服务)          │
│  - PermissionServices (权限服务)          │
└─────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────┐
│  Xinglin.Server.Master.API (API层)      │
│  - DTOs (数据传输对象)                  │
│  - Mappers (对象映射)                   │
│  - ApiModels (API模型)                  │
└─────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────┐
│  Xinglin.Server.Master.Library (全局库)   │
│  - GlobalConfig (全局配置)               │
│  - VersionControl (版本控制)             │
│  - Statistics (统计分析)                │
│  - Monitoring (系统监控)                │
└─────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────┐
│  Xinglin.Core (领域层)                 │
│  - Models (领域模型)                    │
│  - Interfaces (接口定义)                 │
└─────────────────────────────────────────────┘
              ↓
┌─────────────────────────────────────────────┐
│  Xinglin.Infrastructure (基础设施层)      │
│  - Repositories (数据仓储)               │
│  - DbContext (数据库上下文)              │
└─────────────────────────────────────────────┘
```

## 四、功能模块归属总结

### 4.1 报告管理功能
- **表现层**: ReportEntryView, ReportPreviewView, PrintManager
- **应用层**: IReportService, ReportArchiveService, ReportQueryService
- **领域层**: Report模型, IReportRepository接口
- **基础设施层**: ReportRepository, XinglinDbContext
- **横切关注点**: 异常处理, 日志记录

### 4.2 病人信息管理功能
- **表现层**: PatientInfoView, DataAdapterSelectorView
- **应用层**: IPatientService, DataAdapterManager
- **领域层**: Patient模型, IDataAdapter接口
- **基础设施层**: HisDatabaseAdapter, IdCardReaderAdapter
- **横切关注点**: 数据验证, 字符串扩展

### 4.3 模板管理功能
- **表现层**: TemplateSelectorView, TemplateEditorView
- **应用层**: ITemplateService, TemplateManagementService
- **领域层**: Template模型, ITemplateRepository接口
- **基础设施层**: TemplateRepository, JsonConfigurationManager
- **横切关注点**: JSON序列化, 配置管理

### 4.4 授权管理功能
- **表现层**: ActivationView, LicenseInfoView
- **应用层**: IAuthorizationService, LicenseManagementService
- **领域层**: License模型, ILicenseRepository接口
- **基础设施层**: LicenseRepository, MachineCodeGenerator
- **横切关注点**: 加密解密, 哈希计算, 签名验证

### 4.5 打印管理功能
- **表现层**: PrintPreviewView, PrintSettingsView
- **应用层**: PrintManager, PrintQueue
- **领域层**: PrintSettings模型
- **基础设施层**: LocalFileManager, A4PaperRenderer
- **横切关注点**: 异常处理, 日志记录

### 4.6 微信查询功能
- **表现层**: WeChatMiniProgram (小程序前端)
- **应用层**: IWeChatAuthService, ReportForwardService, DataMaskingService
- **领域层**: WeChatUser模型, Report模型
- **基础设施层**: HttpClient, HtmlReportService
- **横切关注点**: 权限验证, 数据脱敏

### 4.7 系统监控功能
- **表现层**: MonitoringDashboard (管理后台)
- **应用层**: HeartbeatService, StatisticsService
- **领域层**: Heartbeat模型, Statistics模型
- **基础设施层**: MonitoringRepository, LogRepository
- **横切关注点**: 日志记录, 异常处理

## 五、设计依据

### 5.1 分层设计原则
1. **单一职责原则**: 每层只负责一个方面的功能
2. **依赖倒置原则**: 高层不依赖低层，都依赖抽象
3. **开闭原则**: 对扩展开放，对修改关闭
4. **接口隔离原则**: 使用最小化接口
5. **迪米特法则**: 最少知识原则

### 5.2 模块划分依据
1. **业务相关性**: 相关功能放在同一模块
2. **复用性**: 可复用的功能放在共享库
3. **独立性**: 可独立开发和部署的模块分开
4. **可测试性**: 每个模块都易于测试

### 5.3 技术选型依据
1. **WPF**: 成熟的桌面应用框架，MVVM架构支持好
2. **ASP.NET Core**: 跨平台，性能优秀，生态完善
3. **SqlSugar**: 轻量级ORM，使用简单，性能好
4. **xUnit**: 成熟的测试框架，支持并行测试
5. **Serilog**: 结构化日志，支持多种输出

### 5.4 安全性设计依据
1. **内外网隔离**: 物理隔离，降低攻击面
2. **数据脱敏**: 保护患者隐私
3. **授权控制**: 机器码绑定，防止盗用
4. **审计日志**: 追溯所有操作
5. **加密传输**: HTTPS加密通信

## 六、后续扩展方向

### 6.1 功能扩展
- 支持更多数据源类型
- 支持更多报告模板格式
- 支持移动端APP
- 支持AI辅助诊断

### 6.2 技术扩展
- 支持微服务架构
- 支持容器化部署
- 支持云原生
- 支持分布式缓存

### 6.3 性能优化
- 数据库读写分离
- 缓存优化
- 异步处理
- 负载均衡